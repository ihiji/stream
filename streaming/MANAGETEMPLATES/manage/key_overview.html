        <script>
            var grid, dataStore, store;
            require([
                "dojo/ready",
                "dojo/_base/xhr",
                "dijit/form/DropDownButton",
                "dijit/TooltipDialog",
                "dijit/form/TextBox",
                "dijit/form/Select",
                "dojox/form/CheckedMultiSelect",
                "dojo/dom",
                "dijit/form/DateTextBox",
                "dojo/date/locale",
                "dojo/domReady!"
            ], function(ready, xhr, DropDownButton, TooltipDialog, TextBox, 
                        Select, CheckedMultiSelect, dom ){
                ready(function(){
                    var planDialog = new TooltipDialog({
                        href: '/manage/dealer/{{dealer_id}}/key/{{key_id}}/plan_list',
                        execute: function(){
                            //TODO - check to see if values have changed
                            //TODO - don't allow add-ons to free plan
                            xhr.post( {
                                url: '/manage/dealer/{{dealer_id}}/key/{{key_id}}/plan_change',
                                content: this.get('value'),
                                handleAs: 'json',
                                load: function(data){showMessage(data)},
                                error: function(data){showMessage(data)}
                            });
                        } 
                    });
                    var dateDialog = new TooltipDialog({
                        href: '/manage/dealer/{{dealer_id}}/key/{{key_id}}/plan_dates',
                        execute: function(){
                            //TODO - check to see if values have changed
                            //TODO - don't allow add-ons to free plan
                            xhr.post( {
                                url: '/manage/dealer/{{dealer_id}}/key/{{key_id}}/date_change',
                                content: this.get('value'),
                                handleAs: 'json',
                                load: function(data){showMessage(data)},
                                error: function(data){showMessage(data)}
                            });
                        } 
                    });

                    var planButton = new DropDownButton({
                        label: "Change Plan",
                        dropDown: planDialog
                    });
                    dom.byId("changeButtonContainer{{key_id}}").appendChild(planButton.domNode);
                    var dateButton = new DropDownButton({
                        label: "Change Dates",
                        dropDown: dateDialog
                    });
                    dom.byId("changeButtonContainer{{key_id}}").appendChild(dateButton.domNode);
                });    
            });
        </script>
        <button onclick="dijit.byId('{{key_id}}').refresh();">Refresh Tab</button>
        <h1>{{name}}</h1>
        <h2>{{site_name}}</h2>
        <div class="infoWrapper">
            <div class="leftBox" id="key_details">
                <span style="font-weight:bold;"><h2 style="margin-top:.2em;">Key Details</h2></span>
                <table>
{% for key, value in key_details.items %}
                <tr>
                    <td style="font-weight:bold;">{{key}}:</td>
                    <td>{{value}}</td>
                </tr>
{% endfor %}
                </table>
            </div>
            <div class="rightBox" id="s_info" >
            </div>
        </div>
        <div id="changeButtonContainer{{key_id}}"></div>
        <br/>

