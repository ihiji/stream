        <script>
            var grid, dataStore, store;
            require([   "dijit/form/FilteringSelect",
                        "dojox/form/CheckedMultiSelect", 
                        "dijit/form/TextBox",
                        "dijit/form/ValidationTextBox",
                        "dojox/validate/web",
                ]);

            require([
                "dojo/ready",
                "dojox/grid/DataGrid",
                "dojo/store/Memory",
                "dojo/data/ObjectStore",
                "dojo/_base/xhr",
                "dijit/TooltipDialog",
                "dijit/form/TextBox",
                "dijit/form/Select",
                "dijit/form/DropDownButton",
                "dojo/dom",
                "dojo/domReady!"
            ], function(ready, DataGrid, Memory, ObjectStore,xhr,
                        TooltipDialog, TextBox, Select,
                        DropDownButton, dom){
                ready(function(){
                    var dealerDialog = new TooltipDialog({
                        href: '/manage/dealer/form_add_dealer',
                        execute: function() {
                            xhr.post({
                                url: '/manage/dealer/form_add_dealer',
                                content: this.get('value'),
                                handleAs: 'json',
                                load: function(data){showMessage(data)},
                                error: function(data){showMessage(data)},
                            });
                        },
                    });

                    var dealerButton = new DropDownButton({
                        label: "Create Dealer",
                        dropDown: dealerDialog
                    });
                    dom.byId("dSummaryChangeButtonContainer").appendChild(dealerButton.domNode);
                    dealerDialog.watch('state', function(property, oval, nval){
                        if (nval == ""){
                            dijit.byId("addDealerButton").set('disabled', false);
                        } else {
                            dijit.byId("addDealerButton").set('disabled', true);
                        }
                    });
                });
                xhr.get({
                    url: "json/dealers.json",
                    handleAs: "json"
                }).then(function(data){
                    store = new Memory({ data: data.items });
                    dataStore = new ObjectStore({ objectStore: store });
    
                    dealerGrid = new DataGrid({
                        store: dataStore,
                        selectable: true,
                        autoWidth: true,
                        autoHeight: '25',
                        sortInfo: 1,
                        rowSelector: 8,
                        query: { id: "*" },
                        structure: [
                            { name: "Dealer", field: "name", width: "250px" },
                            { name: "Primary User", field: "primary_user", width: "200px" },
                            { name: "Primary Email", field: "primary_email", width: "300px" },
                            { name: "Timezone", field: "timezone", width: "100px" }
                        ]
                    }, "dealerGrid");
                    
                    // since we created this grid programmatically, call startup to render it
                    dealerGrid.startup();

                    dealerGrid.on("RowDblClick", function(evt){
                        var idx = evt.rowIndex,
                            item = this.getItem(idx),
                            store = this.store;
                        var id = store.getValue(item,"pk");
                        var name = store.getValue(item,"name");
                        addTab(name, id, "/manage/dealer/" + id + "/");
                    }, true);
                });
            });
        </script>
        <h1>Dealer Management Portal</h1>
        <div id="dSummaryChangeButtonContainer"></div>
        <h2>Dealer list</h2>
        <button onclick="dijit.byId('dealersTab').refresh();">Update List</button>
        <br/>
        <div id="dealerGrid"></div>

